<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>파이썬사랑방 ImageKit - 브라우저 이미지 변환 도구</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="브라우저에서 안전하게 이미지를 변환하는 도구 - 서버 전송 없이 100% 프라이버시 보장">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ImageKit">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="/static/icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/icons/icon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/icons/icon-180x180.png">
    
    <!-- Open Graph / Social Media -->
    <meta property="og:title" content="파이썬사랑방 ImageKit">
    <meta property="og:description" content="브라우저에서 안전하게 이미지를 변환하는 도구">
    <meta property="og:type" content="website">
    <meta property="og:image" content="/static/icons/icon-512x512.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'gradient': 'gradient 8s ease infinite',
                    },
                    keyframes: {
                        gradient: {
                            '0%, 100%': {
                                'background-size': '200% 200%',
                                'background-position': 'left center'
                            },
                            '50%': {
                                'background-size': '200% 200%',
                                'background-position': 'right center'
                            }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .animate-gradient {
            background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #f5576c);
            background-size: 200% 200%;
            animation: gradient 15s ease infinite;
        }
        @keyframes gradient {
            0%, 100% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
        }
        /* Active state for preset buttons */
        .preset-btn.active {
            background-color: rgb(147 51 234); /* purple-600 */
            color: white;
            border: 2px solid rgb(109 40 217); /* purple-700 */
        }
        .preset-btn.active:hover {
            background-color: rgb(109 40 217); /* purple-700 */
        }
        /* PWA Install banner animation */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .animate-slide-in {
            animation: slideIn 0.5s ease-out;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50">
    <!-- PWA Install FAB (Bottom Right) -->
    <div id="installPWAContainer" class="fixed bottom-6 right-6 z-40" style="display: none;">
        <!-- Expanded State -->
        <div id="installPWAExpanded" class="bg-white rounded-xl shadow-xl p-4 mb-3 transform transition-all duration-300 origin-bottom-right" style="display: none; min-width: 280px;">
            <div class="flex items-start space-x-3">
                <div class="flex-shrink-0">
                    <svg class="w-10 h-10 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                    </svg>
                </div>
                <div class="flex-1">
                    <p class="text-base font-semibold text-gray-900">앱으로 설치하기</p>
                    <p class="text-sm text-gray-600 mt-1">홈 화면에 추가하고 오프라인에서도 사용하세요</p>
                    <div class="mt-3 flex space-x-2">
                        <button id="installBtn" class="px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white text-sm font-medium rounded-lg hover:from-purple-700 hover:to-pink-700 transition-colors">
                            설치하기
                        </button>
                        <button id="minimizeBtn" class="px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-200 transition-colors">
                            나중에
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Floating Action Button -->
        <button id="installPWAFab" class="group relative bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-full p-4 shadow-lg hover:shadow-xl transform hover:scale-110 transition-all duration-300">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
            </svg>
            <!-- Pulse animation -->
            <span class="absolute -top-1 -right-1 flex h-3 w-3">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-pink-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-3 w-3 bg-pink-500"></span>
            </span>
            <!-- Tooltip -->
            <div class="absolute bottom-full right-0 mb-2 px-3 py-1 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap">
                앱 설치
            </div>
        </button>
    </div>
    
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <header class="text-center mb-12">
            <div class="inline-block">
                <h1 class="text-5xl font-bold text-transparent bg-clip-text animate-gradient mb-4">
                    🖼️ 파이썬사랑방 ImageKit
                </h1>
            </div>
            <p class="text-gray-600 text-xl mb-6">브라우저에서 안전하게 이미지를 변환하세요</p>
            <div class="flex justify-center gap-6 flex-wrap">
                <span class="inline-flex items-center px-4 py-2 bg-green-100 text-green-800 rounded-full text-sm font-medium">
                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                    </svg>
                    서버 전송 없음
                </span>
                <span class="inline-flex items-center px-4 py-2 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">
                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    100% 프라이버시
                </span>
                <span class="inline-flex items-center px-4 py-2 bg-purple-100 text-purple-800 rounded-full text-sm font-medium">
                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"/>
                    </svg>
                    빠른 처리
                </span>
            </div>
        </header>

        <main>
            <!-- File Upload Area -->
            <div class="bg-white rounded-2xl shadow-xl p-8 mb-8 border-2 border-dashed border-gray-300 hover:border-purple-400 transition-all duration-300 cursor-pointer group" id="uploadArea">
                <div class="text-center">
                    <div class="w-24 h-24 mx-auto mb-4 text-gray-400 group-hover:text-purple-500 transition-colors">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                    </div>
                    <p class="text-xl font-semibold text-gray-700 mb-2">이미지를 드래그하거나 클릭하여 선택하세요</p>
                    <p class="text-gray-500">JPG, PNG 지원 (최대 10MB)</p>
                    <input type="file" id="fileInput" accept="image/jpeg,image/png" multiple hidden>
                </div>
            </div>

            <!-- Image List -->
            <div class="bg-white rounded-2xl shadow-xl p-8 mb-8 hidden" id="imageList">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">선택된 이미지</h2>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4" id="imageGrid"></div>
            </div>

            <!-- Processing Options -->
            <div class="bg-white rounded-2xl shadow-xl p-8 mb-8 hidden" id="optionsPanel">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">변환 옵션</h2>
                
                <!-- Resize Options -->
                <div class="bg-gray-50 rounded-xl p-6 mb-4">
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" id="enableResize" class="w-5 h-5 text-purple-600 rounded focus:ring-purple-500">
                        <span class="ml-3 text-lg font-medium text-gray-700">크기 변경</span>
                    </label>
                    <div class="mt-4 pl-8 hidden" id="resizeOptions">
                        <div class="flex items-center gap-3">
                            <input type="text" id="resizeWidth" placeholder="너비 (px 또는 2x)" 
                                class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <span class="text-gray-500 font-bold">×</span>
                            <input type="text" id="resizeHeight" placeholder="높이 (px 또는 2x)"
                                class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <p class="text-sm text-gray-500 mt-2">예: 1920, 2x, 0.5x</p>
                    </div>
                </div>

                <!-- DPI Options -->
                <div class="bg-gray-50 rounded-xl p-6 mb-6">
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" id="enableDPI" class="w-5 h-5 text-purple-600 rounded focus:ring-purple-500">
                        <span class="ml-3 text-lg font-medium text-gray-700">DPI 변경</span>
                    </label>
                    <div class="mt-4 pl-8 hidden" id="dpiOptions">
                        <select id="dpiValue" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="72">72 DPI (웹용)</option>
                            <option value="96">96 DPI</option>
                            <option value="150">150 DPI</option>
                            <option value="300">300 DPI (인쇄용)</option>
                        </select>
                    </div>
                </div>

                <!-- Process Button -->
                <button class="w-full py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold text-lg rounded-xl hover:from-purple-700 hover:to-pink-700 transform hover:scale-[1.02] transition-all duration-200 shadow-lg" id="processBtn">
                    이미지 변환
                </button>
            </div>

            <!-- Results -->
            <div class="bg-white rounded-2xl shadow-xl p-8 hidden" id="results">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">변환 결과</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="resultGrid"></div>
                <button class="mt-8 px-8 py-3 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 transform hover:scale-[1.02] transition-all duration-200 shadow-lg mx-auto block" id="downloadAllBtn">
                    모두 다운로드
                </button>
            </div>
        </main>

        <!-- Footer -->
        <footer class="text-center mt-12 pb-8">
            <!-- Buy Me a Coffee Section -->
            <div class="mb-4">
                <p class="text-gray-700 text-lg mb-4">
                    이 도구가 도움이 되셨나요?<br>
                    <span class="text-gray-600">여러분의 따뜻한 후원이 더 나은 서비스를 만드는 큰 힘이 됩니다 ☕</span>
                </p>
            </div>
            
            <!-- Buy Me a Coffee Button -->
            <div class="flex justify-center mb-8">
                <a href="https://buymeacoffee.com/allieusleen" target="_blank" rel="noopener noreferrer" 
                   class="inline-flex items-center px-6 py-3 bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-semibold rounded-full transition-all transform hover:scale-105 shadow-lg">
                    <svg class="w-6 h-6 mr-2" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20.216 6.415l-.132-.666c-.119-.598-.388-1.163-1.001-1.379-.197-.069-.42-.098-.57-.241-.152-.143-.196-.366-.231-.572-.065-.378-.125-.756-.192-1.133-.057-.325-.102-.69-.25-.987-.195-.4-.597-.634-.996-.788a5.723 5.723 0 00-.626-.194c-1-.263-2.05-.36-3.077-.416a25.834 25.834 0 00-3.7.062c-.915.083-1.88.184-2.75.5-.318.116-.646.256-.888.501-.297.302-.393.77-.177 1.146.154.267.415.456.692.58.36.162.737.284 1.123.366 1.075.238 2.189.331 3.287.37 1.218.05 2.437.01 3.65-.118.299-.033.598-.073.896-.119.352-.054.578-.513.474-.834-.124-.383-.457-.531-.834-.473-.466.074-.96.108-1.382.146-1.177.08-2.358.082-3.536.006a22.228 22.228 0 01-1.157-.107c-.086-.01-.18-.025-.258-.036-.243-.036-.484-.08-.724-.13-.111-.027-.111-.185 0-.212h.005c.277-.06.557-.108.838-.147h.002c.131-.009.263-.032.394-.048a25.076 25.076 0 013.426-.12c.674.019 1.347.067 2.017.144l.228.031c.267.04.533.088.798.145.392.085.895.113 1.07.542.055.137.08.288.111.431l.319 1.484a.237.237 0 01-.199.284h-.003c-.037.006-.075.01-.112.015a36.704 36.704 0 01-4.743.295 37.059 37.059 0 01-4.699-.304c-.14-.017-.293-.042-.417-.06-.326-.048-.649-.108-.973-.161-.393-.065-.768-.032-1.123.161-.29.16-.527.404-.675.701-.154.316-.199.66-.267 1-.069.34-.176.707-.135 1.056.087.753.613 1.365 1.37 1.502a39.69 39.69 0 0011.343.376.483.483 0 01.535.53l-.071.697-1.018 9.907c-.041.41-.047.832-.125 1.237-.122.637-.553 1.028-1.182 1.171-.577.131-1.165.2-1.756.205-.656.004-1.31-.025-1.966-.022-.699.004-1.556-.06-2.095-.58-.475-.458-.54-1.174-.605-1.793l-.731-7.013-.322-3.094c-.037-.351-.286-.695-.678-.678-.336.015-.718.3-.678.679l.228 2.185.949 9.112c.147 1.344 1.174 2.068 2.446 2.272.742.12 1.503.144 2.257.156.966.016 1.942.053 2.892-.122 1.408-.258 2.465-1.198 2.616-2.657.34-3.332.683-6.663 1.024-9.995l.215-2.087a.484.484 0 01.39-.426c.402-.078.787-.212 1.074-.518.455-.488.546-1.124.385-1.766zm-1.478.772c-.145.137-.363.201-.578.233-2.416.359-4.866.54-7.308.46-1.748-.06-3.477-.254-5.207-.498-.17-.024-.353-.055-.47-.18-.22-.236-.111-.71-.054-.995.052-.26.152-.609.463-.646.484-.057 1.046.148 1.526.22.577.088 1.156.159 1.737.212 2.48.226 5.002.19 7.472-.14.45-.06.899-.13 1.345-.21.399-.072.84-.206 1.08.206.166.281.188.657.162.974a.544.544 0 01-.169.364zm-6.159 3.9c-.862.37-1.84.788-3.109.788a5.884 5.884 0 01-1.569-.217l.877 9.004c.065.78.717 1.38 1.5 1.38 0 0 1.243.065 1.658.065.447 0 1.786-.065 1.786-.065.783 0 1.434-.6 1.499-1.38l.94-9.95a3.996 3.996 0 00-1.322-.238c-.826 0-1.491.284-2.26.613z"/>
                    </svg>
                    <span>Buy me a coffee</span>
                </a>
            </div>
            
            <!-- Copyright and Version -->
            <p class="text-gray-500 text-sm">© <span id="current-year"></span> 파이썬사랑방 ImageKit</p>
            <p class="text-gray-400 text-xs mt-1">v<span id="imagekit-version">{{VERSION}}</span></p>
        </footer>
    </div>

    <!-- Loading Indicator -->
    <div class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden" id="loading">
        <div class="bg-white rounded-2xl p-8 text-center max-w-sm">
            <div class="w-16 h-16 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-lg font-semibold text-gray-800 mb-2">WebAssembly 로딩 중...</p>
            <p class="text-sm text-gray-600 initial-load-message">
                첫 로딩은 최대 20-30초 소요될 수 있습니다.<br>
                이후에는 빠르게 실행됩니다.
            </p>
        </div>
    </div>

    <!-- Crop Modal Dialog -->
    <div class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden" id="cropModal">
        <div class="bg-white rounded-2xl w-[95vw] h-[95vh] overflow-hidden flex flex-col">
            <!-- Modal Header -->
            <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                <h2 class="text-2xl font-bold text-gray-800">이미지 크롭</h2>
                <button class="text-gray-400 hover:text-gray-600 text-3xl leading-none" id="cropModalClose">&times;</button>
            </div>
            
            <!-- Modal Body -->
            <div class="flex-1 overflow-auto p-6" id="cropModalBody">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Canvas Container -->
                    <div class="lg:col-span-2 flex flex-col items-center">
                        <canvas id="cropCanvas" class="border border-gray-300 rounded-lg cursor-crosshair" style="max-width: 100%;"></canvas>
                        <div class="mt-4 text-center">
                            <p class="text-gray-600">마우스로 드래그하여 영역을 선택하세요</p>
                            <div class="text-sm text-gray-500 font-mono mt-2" id="cropCoords"></div>
                        </div>
                    </div>
                    
                    <!-- Preview Container -->
                    <div class="bg-gray-50 rounded-xl p-4 flex flex-col items-center">
                        <h3 class="text-lg font-semibold text-gray-700 mb-3 w-full">미리보기</h3>
                        <canvas id="cropPreview" class="border border-gray-300 rounded-lg bg-white"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Modal Footer -->
            <div class="px-6 py-4 border-t border-gray-200">
                <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                    <!-- Preset Buttons -->
                    <div class="flex gap-2">
                        <button class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors preset-btn" data-ratio="0">자유</button>
                        <button class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors preset-btn" data-ratio="1">1:1</button>
                        <button class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors preset-btn" data-ratio="1.33">4:3</button>
                        <button class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors preset-btn" data-ratio="1.78">16:9</button>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex gap-3">
                        <button class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors" id="cropCancel">취소</button>
                        <button class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors" id="cropApply">적용 및 다운로드</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="static/wasm_exec.js?v={{VERSION}}"></script>
    <script src="static/app.js?v={{VERSION}}"></script>
</body>
</html>